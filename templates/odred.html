{% extends "base.html" %}

{% block title %}
Odred Izviđača "{{ current_user.odred.name }}"
{% endblock %}

{% block style %}
    <link rel="stylesheet" href="{{ url_for('static', filename='odred-style.css') }}" />
{% endblock %}

{% block content %}
  <div class="icon-wrapper">
      <a href="/dashboard"><img src="/static/logo_green.png" alt="Ikona" class="icon-small" /></a>
  </div>
<div class="dashboard-grid">
    <div class="left-col">
        <div class="img-container">
            <img id="output" src="" alt="Fotografija odreda">
        </div>
        {% if current_user.role != "clan" %}
        <div>
            <input type="button" value="Upravljaj odredom" onclick="window.location.href = '{{ url_for('odred.odredDashboard', id=current_user.odred.id) }}'" class="admin-button" />
        </div>
        {% endif %}
    </div>

    <div class="right-col">
        <h2 class="odred-name info">
            Odred Izviđača "{{ current_user.odred.name }}"
        </h2>
        <div class="columns">
            <div class="left-info">
                <table>
                    <caption>Opšte informacije</caption>
                    <tr>
                        <td>Datum osnivanja:</td>
                        <td>{{ current_user.odred.founded_at.day }}.{{ current_user.odred.founded_at.month }}.{{ current_user.odred.founded_at.year }}.</td>
                    </tr>
                    <tr>
                        <td>Mesto:</td>
                        <td>{{ current_user.odred.city }}</td>
                    </tr>
                    <tr>
                        <td>E-Pošta:</td>
                        <td><a href="mailto:{{ current_user.odred.email }}">{{ current_user.odred.email }}</a></td>
                    </tr>
                    <tr>
                        <td>Adresa:</td>
                        <td>{{ current_user.odred.address }}</td>
                    </tr>
                </table>
            </div>
            <div class="right-info">
                <table>
                    <caption>Informacije o organizaciji</caption>
                    <tr>
                        <td>Starešina odreda:</td>
                        <td>{{ current_user.odred.staresina.first_name }} {{ current_user.odred.staresina.last_name }}</td>
                    </tr>
                    <tr>
                        <td>Načelnik odreda:</td>
                        <td>{{ current_user.odred.nacelnik.first_name }} {{ current_user.odred.nacelnik.last_name }}</td>
                    </tr>
                    <tr>
                        <td>Status u savezu:</td>
                        <td>{{ current_user.odred.status }}</td>
                    </tr>
                {% if current_user.role == "admin" %}
                    <tr>
                        <td>Broj članova:</td>
                        <td>{{ broj_clanova }}</td>
                    </tr>
                    <tr>
                        <td>Broj plaćenih članarina:</td>
                        {% if broj_clanarina >= 40 %}
                            <td><span class="good">{{ broj_clanarina }}</span></td>
                        {% else %}
                            <td><span class="bad">{{ broj_clanarina }}</span></td>
                        {% endif %}
                    </tr>
                {% endif %}
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    window.onload = async () => {
        try {
            const response = await fetch(`{{ url_for("savez.getPfp", id = current_user.odred.id ) }}`);
            const text = await response.text();

            if (text !== "default") {
                document.getElementById('output').src = "data:image/jpeg;base64," + text;
            } else {
                document.getElementById('output').src = "/static/sis_logo.jpg";
            }
        } catch (err) {
            console.error("Error loading image:", err);
        }
    };
</script>
{% endblock %}

